{{- $page := .page }}
{{ $summary := .summary }}
{{ $params := $page.Params}}
{{ $featured_image := ($page.Resources.ByType "image").GetMatch "*featured*" }}

{{ $author := partial "functions/get_author_name" $page }}
{{ $publisher := site.Params.org_name | default site.Title }}
{{ $logo_url := partial "functions/get_logo_url" $page -}}
<script type="application/ld+json">
  {
    "@graph": [
      {
        "@id": "ohdsi:database/{{$params.id}}",
        "@type": "ohdsi:Database",
        "administrativeContact": "ohdsi:person/{{$params.administrativeContact.id}}",
        "associatedInstitution": "{{$params.associatedInstitution}}",
        "databaseCharacteristic": [{{ range $i, $e := $params.databaseCharacteristic }}{{ if $i }}, {{ end }}
          {{$e}}{{end}}
        ],
        "databaseSystem": {{$params.databaseSystem}},
        "ohdsi:populationSize": {{$params.populationSize}},
        "principalInvestigator": "ohdsi:person/{{$params.principalInvestigator.id}}",
        "scientificContact": "ohdsi:person/{{$params.scientificContact.id}}",
        "technicalContact": "ohdsi:person/{{$params.technicalContact.id}}",
        "alternateName": {{$params.alternateName}},
        "dateCreated": {{$params.dateCreated}},
        "dateModified": {{$params.dateModified}},
        "description": {{$params.description}},
        "endDate": {{ $params.endDate }},
        "identifier": {{$params.identifier}},
        "name": {{$params.Title}},
        "publication": "ohdsi:{{$params.publication}}",
        "spatialCoverage": {{$params.spatialCoverage}},
        "startDate": {{ $params.startDate }},
        "url": {{$params.databaseUrl}},
        "version": {{$params.version}}
      },
      {
        "@id": "ohdsi:person/{{$params.administrativeContact.id}}",
        "@type": "schema:Person",
        "email": {{$params.administrativeContact.email}},
        "name": {{$params.administrativeContact.name}},
        "telephone": {{$params.administrativeContact.telephone}}
      }
      {{ if ne $params.principalInvestigator.id $params.administrativeContact.id}},{
        "@id": "ohdsi:person/{{$params.principalInvestigator.id}}",
        "@type": "schema:Person",
        "email": {{$params.principalInvestigator.email}},
        "name": {{$params.principalInvestigator.name}},
        "telephone": {{$params.principalInvestigator.telephone}}
      }{{end}}
      {{ if ne $params.scientificContact.id $params.administrativeContact.id }}{{ if ne $params.scientificContact.id $params.principalInvestigator.id }},{
        "@id": "ohdsi:person/{{$params.scientificContact.id}}",
        "@type": "schema:Person",
        "email": {{$params.scientificContact.email}},
        "name": {{$params.scientificContact.name}},
        "telephone": {{$params.scientificContact.telephone}}
      }{{ end }}{{ end }}
      {{ if ne $params.technicalContact.id $params.administrativeContact.id }}{{ if ne $params.technicalContact.id $params.principalInvestigator.id }}{{ if ne $params.technicalContact.id $params.scientificContact.id }},{
        "@id": "ohdsi:person/{{$params.technicalContact.id}}",
        "@type": "schema:Person",
        "email": {{$params.technicalContact.email}},
        "name": {{$params.technicalContact.name}},
        "telephone": {{$params.technicalContact.telephone}}
      }{{ end }}{{ end }}{{ end }}
    ],
    "@id": "urn:x-arq:DefaultGraphNode",
  "@context" : {
    "telephone" : "http://schema.org/telephone",
    "email" : "http://schema.org/email",
    "name" : "http://schema.org/name",
    "scientificContact" : {
      "@id" : "http://data.ohdsi.org/scientificContact",
      "@type" : "@id"
    },
    "principalInvestigator" : {
      "@id" : "http://data.ohdsi.org/principalInvestigator",
      "@type" : "@id"
    },
    "endDate" : {
      "@id" : "http://schema.org/endDate",
      "@type" : "http://www.w3.org/2001/XMLSchema#date"
    },
    "dateCreated" : {
      "@id" : "http://schema.org/dateCreated",
      "@type" : "http://www.w3.org/2001/XMLSchema#date"
    },
    "url" : "http://schema.org/url",
    "startDate" : {
      "@id" : "http://schema.org/startDate",
      "@type" : "http://www.w3.org/2001/XMLSchema#date"
    },
    "dateModified" : {
      "@id" : "http://schema.org/dateModified",
      "@type" : "http://www.w3.org/2001/XMLSchema#date"
    },
    "administrativeContact" : {
      "@id" : "http://data.ohdsi.org/administrativeContact",
      "@type" : "@id"
    },
    "spatialCoverage" : {
      "@id" : "http://schema.org/spatialCoverage",
      "@type" : "@id"
    },
    "alternateName" : "http://schema.org/alternateName",
    "technicalContact" : {
      "@id" : "http://data.ohdsi.org/technicalContact",
      "@type" : "@id"
    },
    "publication" : {
      "@id" : "http://schema.org/publication",
      "@type" : "@id"
    },
    "databaseCharacteristic" : "http://data.ohdsi.org/databaseCharacteristic",
    "description" : "http://schema.org/description",
    "populationSize" : {
      "@id" : "http://data.ohdsi.org/populationSize",
      "@type" : "http://www.w3.org/2001/XMLSchema#integer"
    },
    "identifier" : "http://schema.org/identifier",
    "version" : {
      "@id" : "http://schema.org/version",
      "@type" : "http://www.w3.org/2001/XMLSchema#decimal"
    },
    "associatedInstitution" : "http://data.ohdsi.org/associatedInstitution",
    "databaseSystem" : "http://data.ohdsi.org/databaseSystem",
    "schema" : "http://schema.org/",
    "xsd" : "http://www.w3.org/2001/XMLSchema#",
    "ohdsi" : "http://data.ohdsi.org/",
    "wd" : "https://www.wikidata.org/wiki/"
  }
}
</script>
